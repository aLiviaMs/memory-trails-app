<div class="infinite-scroll">
  <!-- Loading State - handles both initial and more loading -->
  @if (isLoading) {
  <div class="infinite-scroll__loading">
    <p-progressSpinner
      styleClass="infinite-scroll__spinner"
      strokeWidth="3"
      animationDuration="1s"
    >
    </p-progressSpinner>
  </div>
  }

  <!-- Error State -->
  @else if (hasError) {
  <div class="infinite-scroll__error">
    <div class="infinite-scroll__error-content">
      <i class="infinite-scroll__error-icon pi pi-exclamation-triangle"></i>
      <h3 class="infinite-scroll__error-title">Error loading data</h3>
      <p class="infinite-scroll__error-message">
        {{ errorMessage || "An unexpected error occurred. Please try again." }}
      </p>
      <p-button
        label="Try Again"
        icon="pi pi-refresh"
        styleClass="infinite-scroll__error-retry"
        (onClick)="onRetry()"
      >
      </p-button>
    </div>
  </div>
  }

  <!-- Main Content -->
  @else {
  <div class="infinite-scroll__container">
    <cdk-virtual-scroll-viewport
      #viewport
      class="infinite-scroll__viewport"
      [itemSize]="config.itemHeight"
      [minBufferPx]="config.itemHeight * 5"
      [maxBufferPx]="config.itemHeight * 10"
    >
      <!-- Virtual scroll items -->
      @for (item of dataSource; track item.id || $index) {
      <div>
        <ng-container
          [ngTemplateOutlet]="itemTemplate"
          [ngTemplateOutletContext]="{ $implicit: item, index: $index }"
        >
        </ng-container>
      </div>
      }

      <!-- Empty State -->
      @if (dataSource.length === 0 && !isLoading && !hasError) {
      <div class="infinite-scroll__empty">
        <i class="infinite-scroll__empty-icon pi pi-inbox"></i>
        <h3 class="infinite-scroll__empty-title">Nada encontrado</h3>
      </div>
      }
    </cdk-virtual-scroll-viewport>
  </div>
  }
</div>
