<div class="infinite-scroll">
  <!-- Loading State - handles both initial and more loading -->
  @if (isLoading()) {
  <div class="infinite-scroll__loading-initial">
    <p-progressSpinner
      styleClass="infinite-scroll__spinner"
      strokeWidth="3"
      animationDuration="1s"
    >
    </p-progressSpinner>
  </div>
  }

  <!-- Error State -->
  @else if (hasError()) {
  <div class="infinite-scroll__error">
    <div class="infinite-scroll__error-content">
      <i class="infinite-scroll__error-icon pi pi-exclamation-triangle"></i>
      <h3 class="infinite-scroll__error-title">Error loading data</h3>
      <p class="infinite-scroll__error-message">
        {{ errorMessage || "An unexpected error occurred. Please try again." }}
      </p>
      <p-button
        label="Try Again"
        icon="pi pi-refresh"
        styleClass="infinite-scroll__error-retry"
        (onClick)="onRetry()"
      >
      </p-button>
    </div>
  </div>
  }

  <!-- Main Content -->
  @else {
  <div class="infinite-scroll__container">
    <cdk-virtual-scroll-viewport
      #viewport
      class="infinite-scroll__viewport"
      [itemSize]="config.itemHeight"
      [minBufferPx]="config.itemHeight * 5"
      [maxBufferPx]="config.itemHeight * 10"
    >
      <!-- Virtual scroll items -->
      @for (item of dataSource; track item.id || $index) {
      <div>
        <ng-container
          [ngTemplateOutlet]="itemTemplate"
          [ngTemplateOutletContext]="{ $implicit: item, index: $index }"
        >
        </ng-container>
      </div>
      }

      <!-- No More Data Indicator -->
      @if (isComplete() && dataSource.length > 0) {
      <div class="infinite-scroll__complete">
        <i class="infinite-scroll__complete-icon pi pi-check-circle"></i>
        <span class="infinite-scroll__complete-text">All items loaded</span>
      </div>
      }

      <!-- Empty State -->
      @if (dataSource.length === 0 && !isLoading() && !hasError()) {
      <div class="infinite-scroll__empty">
        <i class="infinite-scroll__empty-icon pi pi-inbox"></i>
        <h3 class="infinite-scroll__empty-title">No items found</h3>
        <p class="infinite-scroll__empty-message">
          There is no data to display at the moment.
        </p>
      </div>
      }
    </cdk-virtual-scroll-viewport>
  </div>
  }

  <!-- Scroll to Top Button -->
  @if (dataSource.length > 10) {
  <p-button
    icon="pi pi-angle-up"
    styleClass="infinite-scroll__scroll-top"
    [style.display]="getScrollPosition() > 500 ? 'flex' : 'none'"
    (onClick)="scrollToTop()"
    [rounded]="true"
    [text]="true"
  >
  </p-button>
  }
</div>
