<div class="infinite-scroll">
  <!-- Loading Initial State -->
  @if (isLoadingInitial() && hasError()) {
  <div class="infinite-scroll__loading-initial">
    <p-progressSpinner
      styleClass="infinite-scroll__spinner"
      strokeWidth="3"
      animationDuration="1s"
    >
    </p-progressSpinner>
    <p class="infinite-scroll__loading-text">Carregando dados...</p>
  </div>
  }

  <!-- Error State -->
  @else if (hasError()) {
  <div class="infinite-scroll__error">
    <div class="infinite-scroll__error-content">
      <i class="infinite-scroll__error-icon pi pi-exclamation-triangle"></i>
      <h3 class="infinite-scroll__error-title">Erro ao carregar dados</h3>
      <p class="infinite-scroll__error-message">
        {{ errorMessage || "Ocorreu um erro inesperado. Tente novamente." }}
      </p>
      <p-button
        label="Tentar Novamente"
        icon="pi pi-refresh"
        styleClass="infinite-scroll__error-retry"
        (onClick)="onRetry()"
      >
      </p-button>
    </div>
  </div>
  }

  <!-- Main Content -->
  @else {
  <div class="infinite-scroll__container">
    <cdk-virtual-scroll-viewport
      #viewport
      class="infinite-scroll__viewport"
      [itemSize]="config.itemHeight"
      [minBufferPx]="config.itemHeight * 5"
      [maxBufferPx]="config.itemHeight * 10"
    >
      <!-- Virtual scroll items -->
      @for (item of dataSource; track trackByFn($index, item)) {
      <div>
        <ng-container
          [ngTemplateOutlet]="itemTemplate"
          [ngTemplateOutletContext]="{ $implicit: item, index: $index }"
        >
        </ng-container>
      </div>
      }

      <!-- Loading More Indicator -->
      @if (isLoadingMore()) {
      <div class="infinite-scroll__loading-more">
        <p-progressSpinner
          styleClass="infinite-scroll__spinner infinite-scroll__spinner--small"
          strokeWidth="3"
          animationDuration="1s"
        >
        </p-progressSpinner>
        <span class="infinite-scroll__loading-text">Carregando mais...</span>
      </div>
      }

      <!-- No More Data Indicator -->
      @if (isComplete() && dataSource.length > 0) {
      <div class="infinite-scroll__complete">
        <i class="infinite-scroll__complete-icon pi pi-check-circle"></i>
        <span class="infinite-scroll__complete-text"
          >Todos os itens foram carregados</span
        >
      </div>
      }

      <!-- Empty State -->
      @if (dataSource.length === 0 && !isLoadingInitial() && !hasError()) {
      <div class="infinite-scroll__empty">
        <i class="infinite-scroll__empty-icon pi pi-inbox"></i>
        <h3 class="infinite-scroll__empty-title">Nenhum item encontrado</h3>
        <p class="infinite-scroll__empty-message">
          Não há dados para exibir no momento.
        </p>
      </div>
      }
    </cdk-virtual-scroll-viewport>
  </div>
  }

  <!-- Scroll to Top Button -->
  @if (dataSource.length > 10) {
  <p-button
    icon="pi pi-angle-up"
    styleClass="infinite-scroll__scroll-top"
    [style.display]="getScrollPosition() > 500 ? 'flex' : 'none'"
    (onClick)="scrollToTop()"
    [rounded]="true"
    [text]="true"
  >
  </p-button>
  }
</div>
